/* ===== Theme variables ===== */
:root {
    --bg-body: #030712;
    --bg-surface: #111827;
    --bg-sidebar: #2c3341;
    --bg-elevated: #1f2937;
    --border: #1f2937;
    --border-input: #374151;
    --text: #f3f4f6;
    --text-secondary: #9ca3af;
    --text-muted: #6b7280;
    --msg-user-bg: #1e3a5f;
    --msg-user-text: #e0f2fe;
    --msg-bot-bg: #1f2937;
    --code-block-bg: #0d1117;
    --code-inline-bg: #374151;
    --strong-color: #93c5fd;
    --table-border: #374151;
    --table-header-bg: #1f2937;
    --tool-bg: #1a1a2e;
    --tool-border: #2d2d44;
    --tool-color: #a78bfa;
    --tool-spinner-border: #4c1d95;
    --tool-spinner-top: #a78bfa;
    --error-bg: #3b1111;
    --error-border: #7f1d1d;
    --error-color: #fca5a5;
    --scrollbar-thumb: #374151;
    --welcome-icon-bg: #1f2937;
    --toggle-hover: #1f2937;
    --accent: #2563eb;
    --accent-hover: #3b82f6;
    --accent-bg: rgba(37, 99, 235, 0.15);
    --accent-bg-hover: rgba(37, 99, 235, 0.25);
    --accent-focus-ring: rgba(37, 99, 235, 0.25);
    --disabled-bg: #374151;
    --disabled-text: #6b7280;
}

[data-theme="light"] {
    --bg-body: #f8fafc;
    --bg-surface: #ffffff;
    --bg-sidebar: #e2e4ea;
    --bg-elevated: #f1f5f9;
    --border: #e2e8f0;
    --border-input: #cbd5e1;
    --text: #0f172a;
    --text-secondary: #64748b;
    --text-muted: #94a3b8;
    --msg-user-bg: #dbeafe;
    --msg-user-text: #1e3a5f;
    --msg-bot-bg: #f1f5f9;
    --code-block-bg: #f6f8fa;
    --code-inline-bg: #e2e8f0;
    --strong-color: #293f6f;
    --table-border: #e2e8f0;
    --table-header-bg: #f1f5f9;
    --tool-bg: #ede9fe;
    --tool-border: #c4b5fd;
    --tool-color: #7c3aed;
    --tool-spinner-border: #c4b5fd;
    --tool-spinner-top: #7c3aed;
    --error-bg: #fef2f2;
    --error-border: #fecaca;
    --error-color: #dc2626;
    --scrollbar-thumb: #cbd5e1;
    --welcome-icon-bg: #f1f5f9;
    --toggle-hover: #e2e8f0;
    --accent: #2563eb;
    --accent-hover: #1d4ed8;
    --accent-bg: rgba(37, 99, 235, 0.12);
    --accent-bg-hover: rgba(37, 99, 235, 0.2);
    --accent-focus-ring: rgba(37, 99, 235, 0.25);
    --disabled-bg: #e2e8f0;
    --disabled-text: #94a3b8;
}

/* ===== Base overrides (over Tailwind) ===== */
body {
    background-color: var(--bg-body) !important;
    color: var(--text) !important;
}

/* Theme-aware utility classes (no Tailwind conflict) */
.theme-header {
    background-color: var(--bg-surface) !important;
    border-color: var(--border) !important;
}
.theme-sidebar {
    background-color: var(--bg-sidebar) !important;
    border-color: var(--border) !important;
}
.theme-sidebar-border {
    border-color: var(--border) !important;
}
.theme-label {
    color: var(--text-secondary) !important;
}
.theme-input {
    background-color: var(--bg-surface) !important;
    border: 1px solid var(--border-input) !important;
    color: var(--text) !important;
}
.theme-input::placeholder {
    color: var(--text-muted) !important;
}
.theme-input:focus {
    outline: none !important;
    border-color: var(--accent) !important;
    box-shadow: 0 0 0 2px var(--accent-focus-ring) !important;
}
.theme-accent {
    color: var(--accent) !important;
    background: none !important;
    border: none !important;
    cursor: pointer !important;
}
.theme-accent:hover:not(:disabled) {
    color: var(--accent-hover) !important;
}
.theme-send-btn {
    background-color: var(--accent) !important;
    color: #fff !important;
}
.theme-send-btn:hover:not(:disabled) {
    background-color: var(--accent-hover) !important;
}
.theme-send-btn:disabled {
    background-color: var(--disabled-bg) !important;
    color: var(--disabled-text) !important;
}
.theme-body {
    background-color: var(--bg-body) !important;
    color: var(--text) !important;
}
.theme-muted {
    color: var(--text-muted) !important;
}
.theme-welcome-icon {
    background-color: var(--welcome-icon-bg) !important;
    color: var(--text-muted) !important;
}

header {
    background-color: var(--bg-surface) !important;
    border-color: var(--border) !important;
}

header.theme-header,
footer.theme-header {
    background-color: var(--bg-surface) !important;
}

header label {
    color: var(--text-secondary) !important;
}

footer {
    background-color: var(--bg-surface) !important;
    border-color: var(--border) !important;
}

/* ===== Sidebar (theme-aware) ===== */
aside#sidebar,
#sidebar {
    background-color: var(--bg-sidebar) !important;
    border-color: var(--border) !important;
}
#sidebar label,
#sidebar .text-gray-400 {
    color: var(--text-secondary) !important;
}
#sidebar #db-description {
    background-color: var(--bg-elevated) !important;
    border-color: var(--border-input) !important;
    color: var(--text) !important;
}
#sidebar #db-description::placeholder {
    color: var(--text-muted) !important;
}
#sidebar .border-t.border-gray-800 {
    border-color: var(--border) !important;
}
#sidebar #new-chat-btn,
#sidebar .new-chat-btn {
    color: var(--accent) !important;
    background-color: var(--accent-bg) !important;
    border: 1px solid var(--accent) !important;
    cursor: pointer !important;
    transition: background-color 0.15s, border-color 0.15s, color 0.15s;
}
#sidebar #new-chat-btn:hover:not(:disabled),
#sidebar .new-chat-btn:hover:not(:disabled) {
    color: var(--accent-hover) !important;
    background-color: var(--accent-bg-hover) !important;
    border-color: var(--accent-hover) !important;
}
#sidebar #new-chat-btn:disabled,
#sidebar .new-chat-btn:disabled {
    color: var(--disabled-text) !important;
    background-color: transparent !important;
    border-color: var(--border-input) !important;
    cursor: default !important;
}
#sidebar #new-chat-btn .new-chat-btn-icon {
    flex-shrink: 0;
}
#sidebar #chat-list .chat-item {
    color: var(--text-secondary) !important;
}
#sidebar #chat-list .chat-item.theme-chat-item:hover {
    color: var(--text) !important;
    background-color: var(--toggle-hover) !important;
}
#sidebar #chat-list .chat-item.active {
    color: var(--text) !important;
    background-color: var(--bg-elevated) !important;
}
#sidebar #chat-list .theme-chat-date {
    color: var(--text-muted) !important;
}

/* Chat item row: star + content + delete */
#sidebar #chat-list .chat-item-row {
    display: flex;
    align-items: center;
    gap: 0.25rem;
}
#sidebar #chat-list .chat-item-content {
    min-width: 0;
    overflow: hidden;
    text-overflow: ellipsis;
}
#sidebar #chat-list .chat-star-btn {
    background: none;
    border: none;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--text-muted);
    opacity: 0.7;
}
#sidebar #chat-list .chat-star-btn:hover {
    opacity: 1;
}
#sidebar #chat-list .theme-chat-star {
    color: var(--text-muted);
}
#sidebar #chat-list .theme-chat-star-filled {
    color: var(--accent);
}
#sidebar #chat-list .chat-delete-btn {
    background: none;
    border: none;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--text-muted);
    transition: opacity 0.15s, color 0.15s;
}
#sidebar #chat-list .chat-delete-btn:hover {
    color: var(--error-color);
}
#sidebar #chat-list .chat-item:hover .chat-delete-btn {
    opacity: 1;
}

#db-select option {
    background-color: var(--bg-surface);
    color: var(--text);
}

#welcome > div:first-child {
    background-color: var(--welcome-icon-bg) !important;
}

header .w-px {
    background-color: var(--border-input) !important;
}

/* ===== Scrollbar ===== */
::-webkit-scrollbar {
    width: 6px;
}
::-webkit-scrollbar-track {
    background: transparent;
}
::-webkit-scrollbar-thumb {
    background: var(--scrollbar-thumb);
    border-radius: 3px;
}

/* ===== Theme toggle ===== */
#theme-toggle {
    color: var(--text-secondary);
    cursor: pointer;
    background: none;
    border: none;
    border-radius: 0.5rem;
    padding: 0.375rem;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background-color 0.15s;
}
#theme-toggle:hover {
    background-color: var(--toggle-hover);
}

/* ===== Chat messages ===== */
.msg-user {
    max-width: 80%;
    margin-left: auto;
    background: var(--msg-user-bg);
    color: var(--msg-user-text);
    border-radius: 1rem 1rem 0.25rem 1rem;
    padding: 0.75rem 1rem;
    white-space: pre-wrap;
    word-break: break-word;
}

.msg-assistant {
    max-width: 80%;
    background: var(--msg-bot-bg);
    color: var(--text);
    border-radius: 1rem 1rem 1rem 0.25rem;
    padding: 0.75rem 1rem;
    word-break: break-word;
}

.msg-assistant p  { margin: 0.4em 0; }
.msg-assistant ul,
.msg-assistant ol { margin: 0.4em 0 0.4em 1.5em; }
.msg-assistant li { margin: 0.2em 0; }

.msg-assistant h1,
.msg-assistant h2,
.msg-assistant h3 {
    margin-top: 0.8em;
    margin-bottom: 0.3em;
    font-weight: 600;
}
.msg-assistant h1 { font-size: 1.25rem; }
.msg-assistant h2 { font-size: 1.1rem; }
.msg-assistant h3 { font-size: 1rem; }

.msg-assistant code {
    font-family: 'Cascadia Code', 'Fira Code', 'Consolas', monospace;
    font-size: 0.85em;
}

.msg-assistant pre {
    margin: 0.5em 0;
    border-radius: 0.5rem;
    overflow-x: auto;
}

.msg-assistant pre code {
    display: block;
    padding: 0.75rem 1rem;
    background: var(--code-block-bg);
    border-radius: 0.5rem;
    font-size: 0.82rem;
    line-height: 1.5;
}

.msg-assistant :not(pre) > code {
    background: var(--code-inline-bg);
    padding: 0.15em 0.4em;
    border-radius: 0.25rem;
}

.msg-assistant strong {
    color: var(--strong-color);
}

.msg-assistant table {
    border-collapse: collapse;
    margin: 0.5em 0;
    font-size: 0.85em;
    width: 100%;
}

.msg-assistant th,
.msg-assistant td {
    border: 1px solid var(--table-border);
    padding: 0.35em 0.6em;
    text-align: left;
}

.msg-assistant th {
    background: var(--table-header-bg);
    font-weight: 600;
}

/* ===== Tool call badge ===== */
.tool-badge {
    display: inline-flex;
    align-items: center;
    gap: 0.4rem;
    background: var(--tool-bg);
    border: 1px solid var(--tool-border);
    border-radius: 0.5rem;
    padding: 0.35rem 0.7rem;
    font-size: 0.78rem;
    color: var(--tool-color);
    font-family: 'Cascadia Code', 'Fira Code', 'Consolas', monospace;
}

.tool-badge .spinner {
    width: 12px;
    height: 12px;
    border: 2px solid var(--tool-spinner-border);
    border-top-color: var(--tool-spinner-top);
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

/* ===== System message ===== */
.msg-system {
    text-align: center;
    font-size: 0.8rem;
    color: var(--text-muted);
    padding: 0.25rem;
}

/* ===== Error message ===== */
.msg-error {
    max-width: 80%;
    background: var(--error-bg);
    border: 1px solid var(--error-border);
    border-radius: 0.75rem;
    padding: 0.6rem 1rem;
    color: var(--error-color);
    font-size: 0.9rem;
}

/* ===== Textarea auto-resize ===== */
#user-input {
    background-color: var(--bg-elevated) !important;
    border-color: var(--border-input) !important;
    color: var(--text) !important;
    max-height: 200px;
    line-height: 1.5;
}

#user-input::placeholder {
    color: var(--text-muted) !important;
}

